# 8086汇编语言笔记

- 配套教材：王爽《汇编语言 第四版》
- 视频教程：[贺立坚-8086汇编语言](https://www.bilibili.com/video/BV1Wu411B72F)

## 前置知识

在学习汇编语言之前，需要了解一些相关知识，有助于我们后续学习：

#### 1、汇编语言的产生

- 早期计算机由机器码编写，全部是二进制，例如：10001011，不方便人们的理解和记忆，于是产生了汇编语言

- 汇编语言就是助记符，方便人们理解和记忆、使用，汇编语言的主体是汇编指令

- 对于如下指令：

  - 操作：寄存器 BX 的内容送到 AX 中
  - 机器指令：1000100111011000
  - 汇编指令：mov ax,bx

- 汇编语言不能被计算机识别，想要使用它，就必须得转换成机器语言：

  ![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\001-汇编语言转换成机器语言过程.png)

#### 2、汇编语言的组成

汇编语言的核心就是汇编指令，它决定了汇编语言的特性

- 汇编指令：机器码的助记符，有对应的机器码
- 伪指令：没有对应的机器码，由编译器理解并执行，计算并不执行
- 其他符号：如算术用的，+、-、*、/等，有编译器识别，没有对应机器码

#### 3、指令和数据

- 指令和数据是我们逻辑应用上的概念，在计算机存储器（内存或硬盘上）中都是二进制存放的，关键在于是如何使用和看待它的

例子：对于如下二进制，既可以看作**指令**，又可以看作**数据**

1000100111011000  -> 89D8H(数据)
1000100111011000  -> mov ax,bx(程序)

#### 4、存储单元的划分

存储单位：

- 位(bit)：即能存储一个0或1，是存储信息的最小单位表示形式
- 字节(Byte)：8个bit组成一个1个字节，2^8=256，一个字节可以表示最多256中状态

存储单元：

- 存储单元是个笼统的概念，取决于具体场景下对它的划分。在最小表示情况下，一个存储单元可以存储一个字节，即8个二进制位，若一个存储器有128个存储单元，则它可以存储128个Byte。

常见的单位容量换算：

- 1KB = 1024B
- 1MB = 1024KB
- 1GB = 1024MB
- 1TB = 1024GB

存储单元的划分：

- 如果一个存储器有128个存储单元，则它存储128个字节（1024位）。对存储单元进行编号就是0~127

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\002-存储单元的划分.png)

#### 5、CPU对存储器的读写

CPU如果想要和存储器，尤其是内存进行读写数据，就必须通过总线发出三种信息：

- 地址信息：通过地址总线传输要读写的内存单元地址
- 数据信息：通过数据总线传送读或写的数据
- 控制信息：CPU发出的控制信号，告诉内存此次操作是读出还是写入

**总线：地址总线、数据总线、控制总线这三者合称为系统总线，所谓总线就是传输数据用的一根根物理导线**

例子：CPU从3号内存单元中读写数据的过程

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\003-CPU读取内存单元数据过程.png)

读过程：

- CPU 通过地址线将地址信息3发出。
- CPU 通过控制线发出内存读命令，选中存储器芯片，并通知它，将要从中读取数据。
- 存储器将3号单元中的数据8通过数据线送入 CPU。

写过程：

- CPU 通过地址线将地址信息3发出。
- CPU 通过控制线发出内存写命令，选中存储器芯片，并通知它，要向其中写入
  数据。
-  CPU 通过数据线将数据 26 送入内存的3号单元中。

#### 6、CPU通过三种总线传输数据的示意图

通过地址总线传输地址信息：

- 一个 CPU 有 N 根地址线，则可以说这个 CPU 的地址总线的宽度为 N。这样的 CPU
  最多可以寻找 2 的 N 次方个内存单元。
- 

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\004-传输地址信息.png)

8088CPU通过数据总线传输数据过程：

- 由于8088CPU数据总线只有8位，因此传送16位数据时需要分两次传送

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\005-8088CPU传送数据过程.png)

8086CPU通过数据总线传输数据过程：

- 8086CPU有16根数据总线，一次即可传输完毕

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\006-8086传输过程.png)

## 一、寄存器

#### 1、寄存器介绍

8086CPU有14个寄存器，每个寄存器有16位，可以存放两个字节。

它们的说明和作用如下：

**通用寄存器（4个）：**

- **AX（Accumulator，累加器）**
  - 主要用于乘除运算、BCD运算、换码、I/O操作、串操作、中断调用等。
  - 可分为AH（高8位）和AL（低8位）两部分单独使用。
- **BX（Base，基址寄存器）**
  - 主要用于存放地址、基址（默认相对于DS段）。
  - 也可用来存放数据和地址。
- **CX（Counter，计数器）**
  - 主要用于循环计数、串操作计数、移位计数（CL）等。
- **DX（Data，数据寄存器）**
  - 主要用于16位乘除、间接I/O、中断调用等。
  - 可分为DH（高8位）和DL（低8位）两部分单独使用。

需要注意的是：AX、BX、CX、DX这四个寄存器<span style="color: red">都可以用来存放普通数据，但是又有各自的独特功能</span>

**段寄存器（4个）：**

- **CS（Code Segment，代码段寄存器）**
  - 用于存放正在或正待执行的程序段的起始地址的高16位二进制数据，即程序段的段地址。
- **DS（Data Segment，数据段寄存器）**
  - 用于存放正在或正待处理的一般数据段的起始地址的高16位二进制数据，即一般数据段的段地址。
- **SS（Stack Segment，堆栈数据段寄存器）**
  - 用于存放正在或正待处理的堆栈数据段的起始地址的高16位二进制数据，即堆栈数据段的段地址。
- **ES（Extra Segment，附加数据段寄存器）**
  - 用于存放正在或正待处理的附加数据段的起始地址的高16位二进制数据，即附加数据段的段地址。

**指令指针和变址寄存器（5个）：**

- **SP（Stack Pointer，堆栈指针）**
  - 主要用于存放栈顶地址。
  - 当向堆栈内压入数据时，SP寄存器的值会自动减少；当从堆栈内弹出数据时，SP寄存器的值会自动增加。
- **BP（Base Pointer，基址指针）**
  - 主要用于存放地址、基址（默认相对于SS段）。
  - 可以作为一个索引寄存器，用于访问数组和表格元素。
- **SI（Source Index，源变址寄存器）**
  - 用于存放地址、变址、串操作源变址。
- **DI（Destination Index，目的变址寄存器）**
  - 用于存放地址、变址、串操作目的变址。

- **IP（Instruction Pointer，指令指针）**
  - 用来存放将要执行的下一条指令在现行代码段中的偏移地址。
  - 其内容始终是下一条待执行指令的起始偏移地址，与CS一起形成下一条待执行指令的起始物理地址。

**标志寄存器（1个）：**

- **PSW（Program Status Word，程序状态字）或Flags（标志寄存器）**
  - 用来存放运算结果的特征。
  - 包括3个控制标志（IF、DF、TF）和6个状态标志（SF、PF、ZF、OF、CF、AF）。这些标志通常用于条件分支指令和算术指令的判断。

了解以上8086CPU14个寄存器的作用，才能明白编写汇编语言时对寄存器操作的规则。

#### 2、寄存器结构

8086所有寄存器都是16位的，这里以AX为例，它的结构如下：

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\01-ax寄存器结构.png)

特点：

- 一个16位寄存器可以存储16位(bit)的数
- 为了保持上代CPU兼容性，8086CPU的AX、BX、CX、DX这4个寄存器可以拆分为两个独立的8位寄存器使用
  - AX 可分为 AH 和 AL;
  - BX 可分为 BH 和 BL;
  - CX 可分为 CH 和 CL;
  - DX 可分为 DH 和 DL。

数据在寄存器中存放的例子：

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\02-数据在寄存器中存放的例子.png)

寄存器分为两个8位寄存器使用：

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\03-寄存器分为8位使用.png)

**字**在寄存器中的存储：

- 字节:记为 byte，一个字节由8个bit组成，可以存在8位寄存器中。
- 字:记为 word，一个字由两个字节组成，这两个字节分别称为这个字的高位字节和低位字节

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\04-字的组成.png)

自然的，AH存储高8位，AL存储低8位。这个既可以整体看待成一个数，也可以单独看待成两个字

#### 3、寄存器的搭配使用

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\05-寄存器配合使用.png)

在进行操作CPU寄存器时，根据不同的场景和用途可以归纳以下表格：

| 操作类型   | 隐含的段地址寄存器 | 可替换的段地址寄存器 | 偏移地址所在寄存器                                  |
| ---------- | ------------------ | -------------------- | --------------------------------------------------- |
| 取指令     | CS                 | -                    | IP                                                  |
| 栈访问     | SS                 | -                    | SP（不可修改）                                      |
| 栈操作     | SS                 | CS、DS、ES           | 有效地址（Effective Address）<br>可配合BP寄存器使用 |
| 存取变量   | DS                 | CS、DS、ES           | 有效地址                                            |
| 源字符串   | DS                 | CS、DS、ES           | SI                                                  |
| 目标字符串 | ES                 | -                    | DI                                                  |

#### 4、8086CPU合成物理地址

CPU访问内存单元时，必须给出实际的物理地址，在向地址总线发出地址前，必须在CPU内部合成实际的物理地址。

8086CPU是16位结构的，有如下特性：

- CPU内部运算器一次最大处理的数据位数为16位
- 寄存器最大宽度为16位，即一次最大存储16位数据
- 寄存器和运算器之间的通路为16位

8086CPU物理结构为16位，那么它的地址寻址能力只有64KB（2^16 = 65536个不同的内存地址，内存通常以字节为单位组织，1KB=1024Byte，65536/1024=64KB）。

要想达到1MB的寻址能力，则需要合成20位物理地址，**8086CPU内部采用段地址+偏移地址合成20位物理地址**

![](F:\.计算机知识学习资料\Assembly\learn-assembly-8086\img\06-8086CPU合成物理地址.png)

**合成地址过程：**

- CPU 中的相关部件提供两个 16 位的地址，一个称为段地址，另一个称为偏移地址;
- 段地址和偏移地址通过内部总线传入地址加法器；
- 地址加法器合成20位的物理地址；
- 地址加法器通过内部总线将20位物理地址传送到输入输出控制电路；
- 输入输出控制电路将 20位物理地址送上地址总线；
- 20位物理地址被地址总线传送到存储器。